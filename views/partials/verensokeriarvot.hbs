{{!-- verensokeriarvot--}}
{{#if stories}}
<div class="row">
    <div class="col">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Aika</th>
                        <th>mmol/l</th>
                        <th>Tuntemus</th>
                        <th>G HH</th>
                        <th>Liikunta</th>
                        <th>Kommentti</th>
                        <th>Toiminnot</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each stories}}
                    <tr>
                        <td>{{formatDate createdAt 'MMMM Do YYYY, h:mm a'}}</td>
                        <td>{{mmolPerL}} </td>
                        <td>{{feeling}}</td>
                        <td>{{GHH}}</td>
                        <td>{{sport}} {{sportDuration}} min</td>
                        <td>{{body}}</td>
                        <td>
                            <a href="/stories/edit/{{_id}}" class="btn btn-primary btn-sm mr-2" data-story-id="{{_id}}"><i class="fas fa-edit"></i> Muokkaa</a>
                                 <form action="/stories/{{_id}}" method="POST" id="delete-form">
                                 <input type="hidden" name="_method" value="DELETE">
                                    <button type="submit" class="btn btn-danger btn-sm btnDel" data-story-id="{{_id}}"><i class="fas fa-trash"></i> Poista</button>
                                </form>
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
            {{#if stories}}
<div class="row mt-4">
    <div class="col">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">Arvio</h5>
            </div>
            <div class="card-body">
                {{#each stories}}
                <p>
                    {{#if mmolPerL}}
                    Verensokeriarvot: {{#if (isGoodBloodSugar mmolPerL)}}hyvät{{else}}huonot{{/if}}
                    {{/if}}
                    {{#if feeling}}
                    | Tuntemus: {{feeling}}, {{#if (isGoodFeeling feeling)}}tässä ehdotuksia: lorem ipsum{{else}}tässä ehdotuksia: lirem lorum{{/if}}
                    {{/if}}
                    {{#if GHH}}
                    | Hiilihydraatit: {{#if (isGoodCarbs GHH)}}hyvät{{else}}liikaa{{/if}}
                    {{/if}}
                    {{#if sport}}
                    | Liikunta: {{#if (isGoodSport sportDuration)}}hyvä{{else}}huono{{/if}}
                    {{/if}}
                </p>
                {{/each}}
            </div>
        </div>
    </div>
</div>
{{/if}}

        </div>
    </div>
</div>
{{else}}
<div class="alert alert-warning" role="alert">
    Mittaustuloksia ei löydy
</div>



{{/if}}
<div class="footer">
    <p>
    Hyödyllisiä linkkejä:
    <a href="https://www.kaypahoito.fi/hoi50116"> Yleistä tietoa DIABETES</a> | 
    <a href="https://pubmed.ncbi.nlm.nih.gov/24095141/">HRV</a> | 
    <a href="https://www.yths.fi/">YTHS</a> | © 2023 Balanssi Oy. Kaikki oikeudet pidätetään. 
    <a href="/kayttoehdot">Käyttöehdot</a> | 
    <a href="/tietosuojakaytanto">Tietosuojakäytäntö</a> | 
    <a href="/evasteidenkaytto">Evästeiden käyttö</a>
  </p>
  </div>


<script> src="/arvio.js"</script>


<script>
    // Add event listeners to edit and delete buttons
    const editButtons = document.querySelectorAll('.btn-edit');
    const deleteButtons = document.querySelectorAll('.btnDel');
    editButtons.forEach(button => {
        button.addEventListener('click', (event) => {
            const storyId = button.dataset.storyId;
            window.location.href = `/stories/edit/${storyId}`;
        });
    });
    deleteButtons.forEach(button => {
        button.addEventListener('click', (event) => {
            const storyId = button.dataset.storyId;
            if (confirm('Haluatko varmasti poistaa tämän mittauksen?')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/stories/${storyId}`;
                const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = '_csrf';
                csrfInput.value = csrfToken;
                form.appendChild(csrfInput);
                const methodInput = document.createElement('input');
                methodInput.type = 'hidden';
                methodInput.name = '_method';
                methodInput.value = 'DELETE';
                form.appendChild(methodInput);
                document.body.appendChild(form);
                form.submit();
            }
        });
    });
</script>
